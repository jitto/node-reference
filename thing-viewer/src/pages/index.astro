---
const API_URL = import.meta.env.PUBLIC_API_URL || 'http://thing-api:3000';

// Fetch things from API
let things = [];
let error = null;

try {
  const response = await fetch(`${API_URL}/things`);
  if (response.ok) {
    things = await response.json();
  } else {
    error = 'Failed to fetch things';
  }
} catch (e) {
  error = 'Failed to fetch things';
  console.error(e);
}
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
    <title>Things List</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
        background: #f5f5f5;
      }
      h1 {
        color: #333;
      }
      .things-list {
        list-style: none;
        padding: 0;
      }
      .thing-item {
        background: white;
        padding: 1rem;
        margin: 0.5rem 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .thing-id {
        color: #666;
        font-size: 0.875rem;
      }
      .thing-name {
        font-size: 1.25rem;
        color: #333;
        margin-top: 0.25rem;
      }
      .error {
        color: #d32f2f;
        background: #ffebee;
        padding: 1rem;
        border-radius: 8px;
      }
    </style>	
  </head>
	<body>
    <h1>Things</h1>
    
    {error ? (
      <div class="error">{error}</div>
    ) : things.length === 0 ? (
      <p>No things found.</p>
    ) : (
      <ul class="things-list">
        {things.map(thing => (
          <li class="thing-item">
            <div class="thing-id">ID: {thing.id}</div>
            <div class="thing-name">{thing.name}</div>
          </li>
        ))}
      </ul>
    )}
	</body>
</html>
